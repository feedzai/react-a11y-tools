import { Meta, Story, Canvas, Preview, ArgsTable, Subtitle } from "@storybook/addon-docs/blocks";
import { useRef } from "react";
import { action } from "@storybook/addon-actions";
import { color } from "@storybook/theming";
import styled from "@emotion/styled";
import { RoverProvider, useRover, useFocus } from "../../src/components/roving-tabindex/index";
import * as Styles from "./styles";

<Meta title="Focus/Roving Tabindex" component={RoverProvider} />

export const SidenavLink = ({ disabled, children, onClick }) => {
	const ref = useRef(null);
	const [tabIndex, focused, handleKeyDown, handleClick] = useRover(ref, disabled);
	useFocus(ref, focused);
	return (
		<button
			className="sidenav__link"
			ref={ref}
			onKeyDown={handleKeyDown}
			onClick={() => {
				handleClick();
				onClick();
			}}
			tabIndex={tabIndex}
			disabled={disabled}
		>
			{children}
		</button>
	);
};

# Roving Tabindex

<Subtitle>An accessibility pattern for a grouped set of inputs</Subtitle>

## How to operate this demo

- Use the tab key to navigate to the Menu.

- Then, use the `ArrowUp` and `ArrowDown` keys to go through each option.

- Try pressing `Home` or `End` to jump right to the first or last elements on the group.
- Press `tab` (or `shift+tab`) again to exit.

<Canvas>
	<Story
		name="Roving Tabindex"
		args={{
			direction: "vertical",
		}}
	>
		{(args) => (
			<Styles.Page>
				<Styles.Button type="button">A Button</Styles.Button>
				<RoverProvider {...args}>
					<Styles.Sidenav className="sidenav" id="sidenav">
						<span className="sidenav__label">Menu</span>
						<ul className="sidenav__list">
							<li>
								<SidenavLink disabled={false} onClick={action("Button One clicked")}>
									<div className="sidenav__left">
										<svg className="sidenav__icon" viewBox="0 0 16 16" aria-hidden="true">
											<g
												fill="none"
												strokeWidth="1"
												stroke="currentColor"
												strokeLinecap="round"
												strokeLinejoin="round"
											>
												<polyline points="10.5,3.5 10.5,9.5 8,7.5 5.5,9.5 5.5,3.5" />
												<rect x="0.5" y="0.5" width="15" height="3"></rect>
												<polyline points="14.5,5.5 14.5,14.5 1.5,14.5 1.5,5.5" />
											</g>
										</svg>
										<span className="sidenav__link-text">Orders</span>
									</div>
									<span className="sidenav__counter">10</span>
								</SidenavLink>
							</li>
							<li>
								<SidenavLink disabled={false} onClick={action("Button Two clicked")}>
									<div className="sidenav__left">
										<svg className="sidenav__icon" viewBox="0 0 16 16" aria-hidden="true">
											<path
												fill="none"
												stroke="currentColor"
												strokeWidth="1"
												strokeLinecap="round"
												strokeLinejoin="round"
												d="M14.328,2.672 c-1.562-1.562-4.095-1.562-5.657,0C8.391,2.952,8.18,3.27,8,3.601c-0.18-0.331-0.391-0.65-0.672-0.93 c-1.562-1.562-4.095-1.562-5.657,0c-1.562,1.562-1.562,4.095,0,5.657L8,14.5l6.328-6.172C15.891,6.766,15.891,4.234,14.328,2.672z"
											></path>
										</svg>
										<span className="sidenav__link-text">Wishlist</span>
									</div>
									<span className="sidenav__counter">12</span>
								</SidenavLink>
							</li>
							<li>
								<SidenavLink disabled={false} onClick={action("Button Three clicked")}>
									<div className="sidenav__left">
										<svg className="sidenav__icon" viewBox="0 0 16 16" aria-hidden="true">
											<g
												fill="none"
												strokeWidth="1"
												stroke="currentColor"
												strokeLinecap="round"
												strokeLinejoin="round"
											>
												<polyline points=" 15.5,7.5 8,0.5 0.5,7.5" />
												<polyline points="2.5,8.5 2.5,15.5 6.5,15.5 6.5,11.5 9.5,11.5 9.5,15.5 13.5,15.5 13.5,8.5" />
											</g>
										</svg>
										<span className="sidenav__link-text">Addresses</span>
									</div>
								</SidenavLink>
							</li>
							<li>
								<SidenavLink disabled={false} onClick={action("Button Four clicked")}>
									<div className="sidenav__left">
										<svg className="sidenav__icon" viewBox="0 0 16 16" aria-hidden="true">
											<g
												fill="none"
												strokeWidth="1"
												stroke="currentColor"
												strokeLinecap="round"
												strokeLinejoin="round"
											>
												<line x1="0.5" y1="4.5" x2="15.5" y2="4.5"></line>
												<path d="M5.5,12.5h-4 c-0.552,0-1-0.448-1-1v-10c0-0.552,0.448-1,1-1h13c0.552,0,1,0.448,1,1v5"></path>
												<polygon points="11,15 8.5,15.5 9,13 13.5,8.5 15.5,10.5 "></polygon>
											</g>
										</svg>
										<span className="sidenav__link-text">Payment Methods</span>
									</div>
								</SidenavLink>
							</li>
						</ul>
						<span className="sidenav__label">Other</span>
						<ul className="sidenav__list">
							<li>
								<SidenavLink disabled={false} onClick={action("Button Five clicked")}>
									<div className="sidenav__left">
										<svg className="sidenav__icon" viewBox="0 0 16 16" aria-hidden="true">
											<g
												fill="none"
												strokeWidth="1"
												stroke="currentColor"
												strokeLinecap="round"
												strokeLinejoin="round"
											>
												<path d="M4.318,9A5,5,0,0,0,1.5,13.5h0s2,2,6.5,2,6.5-2,6.5-2h0A5,5,0,0,0,11.681,9"></path>
												<path d="M11.5,4c0,1.933-1.567,4.5-3.5,4.5S4.5,5.933,4.5,4a3.5,3.5,0,0,1,7,0Z"></path>
											</g>
										</svg>
										<span className="sidenav__link-text">Profile Settings</span>
									</div>
								</SidenavLink>
							</li>
							<li>
								<SidenavLink disabled={false} onClick={action("Button Six clicked")}>
									<div className="sidenav__left">
										<svg className="sidenav__icon" viewBox="0 0 16 16" aria-hidden="true">
											<g
												fill="none"
												strokeWidth="1"
												stroke="currentColor"
												strokeLinecap="round"
												strokeLinejoin="round"
											>
												<path d="M6.5,5.5v-3 c0-0.552,0.448-1,1-1h7c0.552,0,1,0.448,1,1v12c0,0.552-0.448,1-1,1h-7c-0.552,0-1-0.448-1-1v-3"></path>
												<line x1="11.5" y1="8.5" x2="0.5" y2="8.5"></line>
												<polyline points="3.5,5.5 0.5,8.5 3.5,11.5" />
											</g>
										</svg>
										<span className="sidenav__link-text">Log Out</span>
									</div>
								</SidenavLink>
							</li>
						</ul>
					</Styles.Sidenav>
				</RoverProvider>
				<Styles.Button type="button">Another Button</Styles.Button>
			</Styles.Page>
		)}
	</Story>
</Canvas>

<ArgsTable story="Roving Tabindex" />

## Component instructions

### 1. Wrap each roving tabindex group in a `RoverProvider`

You can nest roving tabindex components in other DOM elements or React components.

```jsx
<RoverProvider>
	{..content here}
</RoverProvider>
```

You can also choose the direction of the navigation.
It can either be "vertical" (default) or "horizontal".

```jsx
<RoverProvider direction="horizontal">
	{..content here}
</RoverProvider>
```

Choosing between "vertical" and "horizontal" implies you can use:

- `horizontal` - "ArrowLeft" and "ArrowRight" keys
- `vertical` - "ArrowUp" and "ArrowDown"
- `Home` key to go to the first element
- `End` key to go to the last element

### 2. Wrap each focusable element

For composition, try to identify which elements are the ones that are going to be affected by the `RoverProvider`.
For each one of those, wrap them with your own component and use the `useRover` and `useFocus` hooks.

```jsx
const MenuButton = ({ disabled = false, children }) => {
	const buttonRef = useRef(null);

	const [tabIndex, focused, handleKeyDown, handleClick] = useRover(buttonRef, disabled);

	useFocus(focused, buttonRef);

	function onKeyDown(event) {
		handleKeyDown(event);
		yourOwnFunctionToDoWhatever(event);
	}

	function onClick(event) {
		handleClick(event);
		yourOwnFunctionToDoWhatever(event);
	}

	return (
		<button
			ref={ref}
			type="button"
			tabIndex={tabIndex}
			disabled={disabled}
			onKeyDown={handleKeyDown}
			onClick={onClick}
		>
			{children}
		</button>
	);
};
```

### 3. Place them inside your `RoverProvider` structure

Since `RovingTabIndex` relies on React Context, there's no need to have the buttons all as direct children of the provider.
You can nest as deep as you'd like and it will work as well ðŸ™‚

```jsx
<RoverProvider direction="horizontal">
	<MenuButton>First Button</MenuButton>
	<MenuButton disabled>Second Button</MenuButton>
	<ul>
		<li><MenuButton>Another Button</MenuButton>
		<li><MenuButton>Another Button</MenuButton>
		<li><MenuButton>Another Button</MenuButton>
		<li><MenuButton>Another Button</MenuButton>
	</ul>
</RoverProvider>
```

## Differences between `Roving TabIndex` and `Focus Manager`

Both are made to deal with focus and navigation but do it in different ways and for different scenarios:

1. The `FocusManager` can, if necessary, scope the focus inside a group and allows the user to press the `tab` key to move to the next "tabbable" element (or `shift+tab` to move to the previous).

   ðŸ’¡ Tip: Use it for dealing with interface elements that require focus control, like popovers, modals and side menus.

<br />

2. The `RoverProvider` can also manage focus inside a group but, instead of using the `tab` key to move
   back and forth between elements, it uses navigation keys (`ArrowUp`, `ArrowDown`, `ArrowLeft` or `ArrowRight`)
   to do that.

   It also makes the other group's elements unable to receive focus using the `tab` key since it applies the negative `tabindex` to the components that are not currently selected.

   ðŸ’¡ Tip: Use it for dealing with interface elements that require selection, like a custom select element or a navigation menu. (Still, you should try to use the native HTML elements).
